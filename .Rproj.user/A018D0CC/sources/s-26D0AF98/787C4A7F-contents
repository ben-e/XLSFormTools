# Description ------------------------------------------------------------------
# Class definition and constructors for xls_form class.
# Ben Ewing on 2019-08-21

# Libraries --------------------------------------------------------------------
library(dplyr)

# Constructors -----------------------------------------------------------------

#' This is the base XLSForm class. See http://xlsform.org/ for standards.
#'
#' @param survey A tibble representing the survey page of an XLSForm. Must
#'   contain at least type, name, and label columns.
#' @param choices A tibble representing the choices page of an XLSForm. Must
#'   contain at least list_name, name, and label columns.
#' @param settings Optional. A tibble representing the settings page of an
#'   XLSForm.
#'
#' @return An xls_form S3 object representing the survey.
xls_form <- function(survey, choices, settings = NULL) {
  # TODO: Validity checks.
  structure(list(survey = survey, choices = choices, settings =settings),
            class = "xls_form")
}

#' Create a new XLSForm from scratch.
#'
#' See http://xlsform.org/en/#settings-worksheet for more details about this
#' function's parameters.
#'
#' @param form_title Optional. The form's title.
#' @param form_id Optional. The ID of the form, uniquely identifies the form on
#'   server.
#' @param public_key Optional. The public key for encrypted forms.
#' @param submission_url Optional. The URL for submission, overrides the default
#'   server.
#' @param default_language Optional. A string defining the default language.
#' @param version Optional. String of up to 10 digits used to identify the form.
#'   Defaults to YMDH, e.g. 2019082108
#'
#' @return The empty XLSForm.
new_xls_form <- function(form_title = "", form_id = "", public_key = "",
                         submission_url = "", default_language = "",
                         # all_languages = "",
                         version = gsub("[-|:|[:space:]]", "", Sys.time())) {
  # TODO: Handle language correctly
  survey <- tibble(type = character(), name = character(),
                   label = character(), constraint = character(),
                   relevant = character())
  choices <- tibble(list_name = character(), name = numeric(),
                    label = character())

  # For now, just using empty strings for arguments not passed, TODO figure out
  # a better idea.
  settings <- tibble(form_title = form_title, form_id = form_id,
                     public_key = public_key, submission_url = submission_url,
                     default_language = default_language, version = version)
  xls_form(survey, choices, settings)
}
